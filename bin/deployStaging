#!/bin/bash

CURRENT_BRANCH=$TRAVIS_PULL_REQUEST_BRANCH

if [ "$CURRENT_BRANCH" = "" ]; then
    CURRENT_BRANCH=$TRAVIS_BRANCH
fi

HEROKU_APP="staging-chuckjoke"

if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then
    echo "Pull request detected"
    HEROKU_APP="stage-pullrequest-chuckjoke"

    cp servers/stagingServerPullRequest.txt servers/server.txt
else
    cp servers/stagingServerBranch.txt servers/server.txt
fi

echo "Current branch: "
echo $CURRENT_BRANCH

echo "Heroku app used: "
echo $HEROKU_APP

heroku git:remote -a $HEROKU_APP -r staging

echo "DEBUG: RUNNING THIS COMMAND:"
echo "git push -fu staging $CURRENT_BRANCH:master"

git push -fu staging $CURRENT_BRANCH:master
